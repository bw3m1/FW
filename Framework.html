<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>History</title>
    <link rel="icon" type="image/svg" id="favicon" href="icon.svg">
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }

      #nav-bar {
        display: flex;
        padding: 8px;
        background: #f1f1f1;
        align-items: center;
        gap: 8px;
      }

      #url-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 20px;
        outline: none;
        font-size: 14px;
      }

      .nav-button {
        padding: 8px 12px;
        border: none;
        background: #ddd;
        border-radius: 4px;
        cursor: pointer;
      }

      .nav-button:hover {
        background: #ccc;
      }

      #iframe-container {
        height: calc(100% - 44px);
        position: relative;
      }

      #iframe {
        border: none;
        width: 100%;
        height: 100%;
      }

      #error-message {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        background: #ffebee;
        color: #c62828;
        padding: 10px;
        display: none;
        z-index: 10;
      }

      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none;
        z-index: 5;
      }

      #alternate-options {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        display: none;
        z-index: 5;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      #alternate-options button {
        margin: 5px;
        padding: 8px 16px;
        background: #4285f4;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      #alternate-options button:hover {
        background: #3367d6;
      }
    </style>
  </head>
  <body>
    <div id="nav-bar">
      <button class="nav-button" id="back-button" title="Back">←</button>
      <button class="nav-button" id="forward-button" title="Forward">→</button>
      <button class="nav-button" id="refresh-button" title="Refresh">↻</button>
      <input type="text" id="url-input" placeholder="Enter URL (e.g., google.com)">
      <button class="nav-button" id="go-button">Go</button>
    </div>
    <div id="iframe-container">
      <div id="error-message"></div>
      <div id="loading">Loading...</div>
      <div id="alternate-options">
        <h3>This site can't be embedded</h3>
        <p>The website you're trying to visit prevents being displayed in frames for security reasons.</p>
        <button id="open-new-tab">Open in New Tab</button>
        <button id="try-anyway">Try Anyway</button>
      </div>
      <iframe src="https://en.wikipedia.org" id="iframe" title="Browser Frame" frameborder="0" allow="fullscreen"
        allowfullscreen></iframe>
    </div>

    <script>
      const iframe = document.getElementById('iframe');
        const urlInput = document.getElementById('url-input');
        const backButton = document.getElementById('back-button');
        const forwardButton = document.getElementById('forward-button');
        const refreshButton = document.getElementById('refresh-button');
        const goButton = document.getElementById('go-button');
        const errorMessage = document.getElementById('error-message');
        const loadingIndicator = document.getElementById('loading');
        const alternateOptions = document.getElementById('alternate-options');
        const openNewTabBtn = document.getElementById('open-new-tab');
        const tryAnywayBtn = document.getElementById('try-anyway');
        
        // List of domains that typically block iframe embedding
        const blockedDomains = [
          'github.com',
          'chat.deepseek.com',
          'facebook.com',
          'twitter.com',
          'instagram.com',
          'linkedin.com'
        ];
        
        // Initialize URL input with current iframe src
        urlInput.value = iframe.src;
        let currentUrl = iframe.src;
        
        // Helper function to format URLs properly
        function formatUrl(url) {
          url = url.trim();
          
          // Remove any existing protocol
          url = url.replace(/^https?:\/\//i, '');
          
          // Add https:// by default
          if (!url.startsWith('http://') && !url.startsWith('https://')) {
            // Check if it's a domain with a dot or localhost
            if (url.includes('.') || url.startsWith('localhost')) {
              url = 'https://' + url;
            } else {
              // Probably a search term - use Google search
              url = 'https://google.com/search?q=' + encodeURIComponent(url);
            }
          }
          
          return url;
        }
        
        // Check if a URL is likely to block iframe embedding
        function isLikelyBlocked(url) {
          try {
            const domain = new URL(url).hostname;
            return blockedDomains.some(blocked => domain.includes(blocked));
          } catch {
            return false;
          }
        }
        
        // Update iframe URL when Go button is clicked or Enter is pressed
        function navigateToUrl() {
          let url = urlInput.value.trim();
          
          if (!url) return;
          
          try {
            url = formatUrl(url);
            const parsedUrl = new URL(url); // Validate URL
            
            // Check if this is a known blocked domain
            if (isLikelyBlocked(url)) {
              showAlternateOptions(url);
              return;
            }
            
            loadingIndicator.style.display = 'block';
            errorMessage.style.display = 'none';
            alternateOptions.style.display = 'none';
            
            currentUrl = url;
            iframe.src = url;
          } catch (e) {
            showError('Invalid URL format');
          }
        }
        
        function showAlternateOptions(url) {
          currentUrl = url;
          loadingIndicator.style.display = 'none';
          errorMessage.style.display = 'none';
          alternateOptions.style.display = 'block';
          
          openNewTabBtn.onclick = () => {
            window.open(url, '_blank');
            alternateOptions.style.display = 'none';
          };
          
          tryAnywayBtn.onclick = () => {
            alternateOptions.style.display = 'none';
            loadingIndicator.style.display = 'block';
            iframe.src = url;
          };
        }
        
        function showError(message) {
          errorMessage.textContent = message;
          errorMessage.style.display = 'block';
          loadingIndicator.style.display = 'none';
          alternateOptions.style.display = 'none';
        }
        
        function hideError() {
          errorMessage.style.display = 'none';
        }
        
        goButton.addEventListener('click', navigateToUrl);
        urlInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            navigateToUrl();
          }
        });
        
        // Navigation buttons
        backButton.addEventListener('click', () => {
          try {
            iframe.contentWindow.history.back();
          } catch (e) {
            console.log('Navigation blocked by CORS');
          }
        });
        
        forwardButton.addEventListener('click', () => {
          try {
            iframe.contentWindow.history.forward();
          } catch (e) {
            console.log('Navigation blocked by CORS');
          }
        });
        
        refreshButton.addEventListener('click', () => {
          iframe.src = iframe.src;
        });
        
        // Handle iframe events
        iframe.addEventListener('load', function() {
          loadingIndicator.style.display = 'none';
          try {
            // This will only work for same-origin iframes
            urlInput.value = this.contentWindow.location.href;
            
            // Update title and favicon
            const iframeTitle = this.contentDocument?.title || 'Browser Frame';
            document.title = iframeTitle;
            
            const iframeFavicon = this.contentDocument?.querySelector('link[rel="icon"]')?.href 
                                || 'https://en.wikipedia.org/static/favicon/wikipedia.ico';
            document.getElementById('favicon').href = iframeFavicon;
          } catch (e) {
            // CORS will block access to iframe content from different origins
            urlInput.value = this.src;
          }
        });
        
        iframe.addEventListener('error', () => {
          loadingIndicator.style.display = 'none';
          showAlternateOptions(currentUrl);
        });
    </script>
  </body>
</html>